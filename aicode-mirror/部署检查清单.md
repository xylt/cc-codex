# AI Code Mirror 部署检查清单

## 📋 部署前准备

### 服务器准备
- [ ] 已购买阿里云 ECS 服务器
- [ ] 服务器配置: 2核4GB 或以上
- [ ] 操作系统: Ubuntu 22.04 LTS
- [ ] 已获取服务器公网 IP
- [ ] 可通过 SSH 连接服务器

### 域名准备（可选）
- [ ] 已购买域名
- [ ] DNS 解析已配置 A 记录指向服务器 IP
- [ ] DNS 生效（可通过 `ping 域名` 验证）

### 本地准备
- [ ] 项目代码已完成并测试
- [ ] 已安装 Node.js 18.x
- [ ] 已安装 Git（如果使用 Git 部署）

---

## 🚀 首次部署检查

### 1. 上传文件
- [ ] 方式 A: 通过 Git 推送到仓库
- [ ] 方式 B: 通过 SCP 上传到服务器
- [ ] 文件已上传到 `/var/www/aicode-mirror`

### 2. 服务器初始化
- [ ] 运行 `setup-server.sh` 脚本
- [ ] Node.js 已安装: `node --version`
- [ ] npm 已安装: `npm --version`
- [ ] PM2 已安装: `pm2 --version`
- [ ] Nginx 已安装: `nginx -v`
- [ ] MongoDB 已安装（如需要）: `mongod --version`
- [ ] 防火墙已配置: `ufw status`

### 3. 环境配置
- [ ] 复制 `.env.production` 并配置
- [ ] 修改 `JWT_SECRET` 为随机字符串
- [ ] 修改 `CORS_ORIGIN` 为实际域名
- [ ] 修改 `MONGODB_URI` 连接字符串
- [ ] 其他配置项已检查

### 4. Nginx 配置
- [ ] 复制 `nginx.conf` 到 `/etc/nginx/sites-available/`
- [ ] 修改配置文件中的域名
- [ ] 创建软链接到 `sites-enabled`
- [ ] 删除默认配置
- [ ] 配置文件测试通过: `nginx -t`
- [ ] Nginx 已重启: `systemctl restart nginx`

### 5. 前端构建
- [ ] 进入前端目录: `cd frontend`
- [ ] 安装依赖: `npm install`
- [ ] 执行构建: `npm run build`
- [ ] dist 目录已生成
- [ ] dist 目录包含 index.html 和资源文件

### 6. 后端部署
- [ ] 进入后端目录: `cd backend`
- [ ] 安装依赖: `npm install --production`
- [ ] 创建日志目录: `mkdir -p logs`
- [ ] PM2 启动成功: `npm run pm2:start`
- [ ] PM2 状态正常: `pm2 status`
- [ ] PM2 已保存: `pm2 save`

### 7. 部署验证
- [ ] 后端健康检查: `curl http://localhost:3001/health`
- [ ] 可访问前端: `http://服务器IP` 或 `http://域名`
- [ ] 登录功能正常
- [ ] API 调用正常
- [ ] Dashboard 数据正常显示
- [ ] 支付功能正常（测试环境）

---

## 🔒 安全配置检查

### HTTPS 配置（推荐）
- [ ] 已安装 Certbot
- [ ] SSL 证书已获取
- [ ] Nginx HTTPS 配置已启用
- [ ] HTTP 自动跳转 HTTPS
- [ ] 证书自动续期已配置

### 防火墙配置
- [ ] SSH 端口 22 已开放
- [ ] HTTP 端口 80 已开放
- [ ] HTTPS 端口 443 已开放
- [ ] 其他端口已关闭
- [ ] UFW 防火墙已启用

### 安全加固
- [ ] 已修改 SSH 默认端口（可选）
- [ ] 已禁用 root 密码登录（可选）
- [ ] 已配置 SSH 密钥登录
- [ ] 已安装 fail2ban（可选）
- [ ] 数据库未暴露在公网

---

## 📊 监控配置检查

### 日志配置
- [ ] PM2 日志正常: `pm2 logs`
- [ ] Nginx 访问日志存在
- [ ] Nginx 错误日志存在
- [ ] 应用日志目录可写

### 监控告警
- [ ] PM2 进程监控已启用
- [ ] 服务器资源监控已配置（可选）
- [ ] 错误告警已配置（可选）

---

## 🔄 日常运维检查

### 备份配置
- [ ] 数据库备份脚本已配置
- [ ] 定时备份任务已添加到 crontab
- [ ] 备份文件可正常恢复
- [ ] 配置文件已备份

### 更新流程
- [ ] 部署脚本 `deploy.sh` 可正常执行
- [ ] Git 拉取代码正常
- [ ] 前端构建正常
- [ ] 后端重启正常
- [ ] 服务无中断部署（可选）

---

## 🐛 问题排查清单

### 前端问题
- [ ] 页面能否正常加载
- [ ] 静态资源能否正常加载
- [ ] 控制台是否有 JavaScript 错误
- [ ] API 请求是否正常
- [ ] 路由跳转是否正常

### 后端问题
- [ ] PM2 状态是否正常
- [ ] 后端日志是否有错误
- [ ] 数据库连接是否正常
- [ ] API 端点是否可访问
- [ ] 环境变量是否正确配置

### Nginx 问题
- [ ] Nginx 状态是否正常
- [ ] 配置文件是否有语法错误
- [ ] 反向代理是否正确配置
- [ ] 访问日志是否有异常请求
- [ ] 错误日志是否有错误信息

### 系统问题
- [ ] 磁盘空间是否充足: `df -h`
- [ ] 内存使用是否正常: `free -h`
- [ ] CPU 使用是否正常: `top`
- [ ] 网络连接是否正常: `netstat -tulpn`
- [ ] 系统日志是否有异常: `journalctl -xe`

---

## ✅ 部署完成确认

- [ ] 网站可通过域名访问
- [ ] 所有页面功能正常
- [ ] 用户注册登录正常
- [ ] 支付流程测试通过
- [ ] API Key 生成正常
- [ ] 性能测试通过
- [ ] 压力测试通过（可选）
- [ ] 已通知团队部署完成
- [ ] 已更新部署文档
- [ ] 已创建首个数据库备份

---

## 📞 支持联系

如果遇到部署问题：

1. 查看 [部署文档.md](./部署文档.md) 的"常见问题"章节
2. 查看日志文件定位问题
3. 联系技术支持: 微信 `aicode-support`

---

**提示**: 建议将此清单打印或保存，每次部署时逐项检查，确保不遗漏任何步骤。
